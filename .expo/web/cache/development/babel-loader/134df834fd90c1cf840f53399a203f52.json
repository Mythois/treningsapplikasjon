{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport { collection, getDocs, query } from \"firebase/firestore\";\nimport { db } from \"../../firebase\";\nimport { LocalData } from \"../LocalData\";\nimport { WorkoutUser } from \"./WorkoutUser\";\nvar UsersCollectionLoader = function () {\n  function UsersCollectionLoader() {\n    _classCallCheck(this, UsersCollectionLoader);\n    this.collectionRef = collection(db, \"users\");\n    this.loaded = false;\n    this.users = [];\n  }\n  _createClass(UsersCollectionLoader, [{\n    key: \"getUsers\",\n    value: function getUsers() {\n      return this.users;\n    }\n  }, {\n    key: \"load\",\n    value: function () {\n      var _load = _asyncToGenerator(function* (completion) {\n        var _this = this;\n        if (this.loaded) {\n          return;\n        }\n        this.users = [];\n        var q = query(this.collectionRef);\n        var querySnapshot = yield getDocs(q).then(function (docs) {\n          _this.users.push(LocalData.currentUser);\n          docs.forEach(function (doc) {\n            var u = new WorkoutUser(doc.data());\n            if (u.username != \"\" && u.username != LocalData.currentUser.username) _this.users.push(u);\n          });\n          completion(_this.users);\n        }).catch(function (error) {\n          return console.log(error.message);\n        }).finally(function () {\n          if (_this.users.length > 0) _this.loaded = true;\n          console.log(\"Loaded users:\", _this.users);\n        });\n      });\n      function load(_x) {\n        return _load.apply(this, arguments);\n      }\n      return load;\n    }()\n  }, {\n    key: \"searchUsers\",\n    value: function searchUsers(s) {\n      var returnUsers = [];\n      var search = s.toLowerCase();\n      if (search.length < 2) {\n        return returnUsers;\n      }\n      this.users.forEach(function (user) {\n        var un = user.username.toLowerCase();\n        var name = user.name.toLowerCase();\n        if (un.includes(search) || name.includes(search)) returnUsers.push(user);\n      });\n      return returnUsers;\n    }\n  }]);\n  return UsersCollectionLoader;\n}();\nexport { UsersCollectionLoader as default };","map":{"version":3,"names":["collection","getDocs","query","db","LocalData","WorkoutUser","UsersCollectionLoader","collectionRef","loaded","users","completion","q","querySnapshot","then","docs","push","currentUser","forEach","doc","u","data","username","catch","error","console","log","message","finally","length","s","returnUsers","search","toLowerCase","user","un","name","includes"],"sources":["C:/Users/tommy/OneDrive/Documents/school/softwareDevelopment/treningsapplikasjon/LocalData/Users/UserCollectionLoader.ts"],"sourcesContent":["import { collection, getDocs, query, serverTimestamp } from \"firebase/firestore\";\r\nimport { db } from \"../../firebase\";\r\nimport { LocalData } from \"../LocalData\";\r\nimport { WorkoutUser } from \"./WorkoutUser\";\r\n\r\n\r\n/**\r\n * UsersCollectionLoader helper class for working with collections in firebase.\r\n */\r\nexport default class UsersCollectionLoader {\r\n    // Attributes\r\n    collectionRef = collection(db, \"users\");\r\n    \r\n    loaded: boolean = false;\r\n    \r\n    private users: WorkoutUser[] = [];\r\n    /**\r\n     * Get users method. Make sure document is loaded before using.\r\n     * @returns the users in the collection.\r\n     */\r\n    public getUsers(): WorkoutUser[] {\r\n        return this.users;\r\n    }\r\n\r\n    // load, loaded\r\n    /**\r\n     * Loads the collection\r\n     * @param completion \r\n     */\r\n    async load(completion: (documents: WorkoutUser[]) => void) {\r\n        if (this.loaded) { return; }\r\n        this.users = [];\r\n        // Creating a loading query\r\n        const q = query(this.collectionRef);\r\n        const querySnapshot = await getDocs(q)\r\n        .then((docs) => {\r\n            this.users.push(LocalData.currentUser);\r\n            docs.forEach((doc) => {\r\n                const u = new WorkoutUser(doc.data());\r\n                if (u.username != \"\" &&\r\n                u.username != LocalData.currentUser.username) \r\n                    this.users.push(u);\r\n            })\r\n            completion(this.users);\r\n        })\r\n        .catch(error => console.log(error.message))\r\n        .finally(() => {\r\n            if (this.users.length > 0) this.loaded = true;\r\n            console.log(\"Loaded users:\", this.users);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Search for users by their username. This method is to be used in search functions by input.\r\n     * @param s the search keyword\r\n     * @returns an array of the matching users.\r\n     */\r\n    public searchUsers(s: string): WorkoutUser[] {\r\n        const returnUsers: WorkoutUser[] = []\r\n        const search = s.toLowerCase();\r\n        if (search.length < 2) { return returnUsers; }\r\n        this.users.forEach(user => {\r\n            const un = user.username.toLowerCase();\r\n            const name = user.name.toLowerCase();\r\n            if (un.includes(search) || name.includes(search)) \r\n                returnUsers.push(user);\r\n        })\r\n        return returnUsers;\r\n    }\r\n}"],"mappings":";;;AAAA,SAASA,UAAU,EAAEC,OAAO,EAAEC,KAAK,QAAyB,oBAAoB;AAChF,SAASC,EAAE;AACX,SAASC,SAAS;AAClB,SAASC,WAAW;AAAwB,IAMvBC,qBAAqB;EAAA;IAAA;IAAA,KAEtCC,aAAa,GAAGP,UAAU,CAACG,EAAE,EAAE,OAAO,CAAC;IAAA,KAEvCK,MAAM,GAAY,KAAK;IAAA,KAEfC,KAAK,GAAkB,EAAE;EAAA;EAAA;IAAA;IAAA,OAKjC,oBAAiC;MAC7B,OAAO,IAAI,CAACA,KAAK;IACrB;EAAC;IAAA;IAAA;MAAA,8BAOD,WAAWC,UAA8C,EAAE;QAAA;QACvD,IAAI,IAAI,CAACF,MAAM,EAAE;UAAE;QAAQ;QAC3B,IAAI,CAACC,KAAK,GAAG,EAAE;QAEf,IAAME,CAAC,GAAGT,KAAK,CAAC,IAAI,CAACK,aAAa,CAAC;QACnC,IAAMK,aAAa,SAASX,OAAO,CAACU,CAAC,CAAC,CACrCE,IAAI,CAAC,UAACC,IAAI,EAAK;UACZ,KAAI,CAACL,KAAK,CAACM,IAAI,CAACX,SAAS,CAACY,WAAW,CAAC;UACtCF,IAAI,CAACG,OAAO,CAAC,UAACC,GAAG,EAAK;YAClB,IAAMC,CAAC,GAAG,IAAId,WAAW,CAACa,GAAG,CAACE,IAAI,EAAE,CAAC;YACrC,IAAID,CAAC,CAACE,QAAQ,IAAI,EAAE,IACpBF,CAAC,CAACE,QAAQ,IAAIjB,SAAS,CAACY,WAAW,CAACK,QAAQ,EACxC,KAAI,CAACZ,KAAK,CAACM,IAAI,CAACI,CAAC,CAAC;UAC1B,CAAC,CAAC;UACFT,UAAU,CAAC,KAAI,CAACD,KAAK,CAAC;QAC1B,CAAC,CAAC,CACDa,KAAK,CAAC,UAAAC,KAAK;UAAA,OAAIC,OAAO,CAACC,GAAG,CAACF,KAAK,CAACG,OAAO,CAAC;QAAA,EAAC,CAC1CC,OAAO,CAAC,YAAM;UACX,IAAI,KAAI,CAAClB,KAAK,CAACmB,MAAM,GAAG,CAAC,EAAE,KAAI,CAACpB,MAAM,GAAG,IAAI;UAC7CgB,OAAO,CAACC,GAAG,CAAC,eAAe,EAAE,KAAI,CAAChB,KAAK,CAAC;QAC5C,CAAC,CAAC;MACN,CAAC;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA,OAOD,qBAAmBoB,CAAS,EAAiB;MACzC,IAAMC,WAA0B,GAAG,EAAE;MACrC,IAAMC,MAAM,GAAGF,CAAC,CAACG,WAAW,EAAE;MAC9B,IAAID,MAAM,CAACH,MAAM,GAAG,CAAC,EAAE;QAAE,OAAOE,WAAW;MAAE;MAC7C,IAAI,CAACrB,KAAK,CAACQ,OAAO,CAAC,UAAAgB,IAAI,EAAI;QACvB,IAAMC,EAAE,GAAGD,IAAI,CAACZ,QAAQ,CAACW,WAAW,EAAE;QACtC,IAAMG,IAAI,GAAGF,IAAI,CAACE,IAAI,CAACH,WAAW,EAAE;QACpC,IAAIE,EAAE,CAACE,QAAQ,CAACL,MAAM,CAAC,IAAII,IAAI,CAACC,QAAQ,CAACL,MAAM,CAAC,EAC5CD,WAAW,CAACf,IAAI,CAACkB,IAAI,CAAC;MAC9B,CAAC,CAAC;MACF,OAAOH,WAAW;IACtB;EAAC;EAAA;AAAA;AAAA,SA3DgBxB,qBAAqB"},"metadata":{},"sourceType":"module"}